<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Destinat√°rios | LegadoBox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .plan-card { border: 2px solid transparent; transition: all 0.3s ease; }
        .plan-free { border-color: #f59e0b; background: linear-gradient(135deg, #fef3c7, #fde68a); }
        .plan-premium { border-color: #10b981; background: linear-gradient(135deg, #d1fae5, #a7f3d0); }
        .plan-vip { border-color: #8b5cf6; background: linear-gradient(135deg, #ede9fe, #ddd6fe); }
        .recipient-card { border: 1px solid #e5e7eb; transition: all 0.3s ease; }
        .recipient-card:hover { border-color: #667eea; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1); }
        .form-section { border-left: 4px solid #667eea; }
        .fade-in { animation: fadeIn 0.6s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-4 px-4">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                    <i data-lucide="heart" class="w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold">LegadoBox</h1>
                    <p class="text-white/80 text-sm">Gerenciar Destinat√°rios</p>
                </div>
            </div>
            <button onclick="goBack()" class="flex items-center space-x-2 text-white/80 hover:text-white">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                <span>Voltar ao Dashboard</span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="py-8 px-4">
        <div class="max-w-6xl mx-auto">
            
            <!-- Page Title -->
            <div class="text-center mb-8 fade-in">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">üë• Meus Destinat√°rios</h2>
                <p class="text-xl text-gray-600">Gerencie as pessoas que receber√£o seus legados digitais</p>
            </div>

            <!-- Plan Status Card -->
            <div class="mb-8 fade-in">
                <div id="planCard" class="plan-card rounded-2xl p-6 plan-free">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                                <i data-lucide="crown" class="w-6 h-6 text-amber-600"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900" id="planName">Plano Gratuito</h3>
                                <p class="text-gray-700" id="planDescription">Voc√™ pode cadastrar at√© 2 destinat√°rios</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl font-bold text-gray-900" id="currentCount">0</span>
                                <span class="text-gray-500">/</span>
                                <span class="text-lg text-gray-600" id="maxCount">2</span>
                                <i data-lucide="users" class="w-5 h-5 text-gray-500"></i>
                            </div>
                            <button onclick="upgradePlan()" class="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition-colors flex items-center space-x-2">
                                <i data-lucide="arrow-up" class="w-4 h-4"></i>
                                <span>Fazer Upgrade</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="mt-4">
                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                            <span>Destinat√°rios cadastrados</span>
                            <span id="progressText">0%</span>
                        </div>
                        <div class="w-full bg-white/50 rounded-full h-2">
                            <div id="progressBar" class="bg-amber-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recipients List -->
            <div class="mb-8 fade-in">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-2xl font-bold text-gray-900">üìã Destinat√°rios Cadastrados</h3>
                            <button onclick="showAddForm()" id="addButton" class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity flex items-center space-x-2">
                                <i data-lucide="plus" class="w-5 h-5"></i>
                                <span>Adicionar Destinat√°rio</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="recipientsList" class="p-6">
                        <!-- Recipients will be loaded here -->
                        <div class="text-center py-12">
                            <i data-lucide="users" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                            <h4 class="text-xl font-medium text-gray-500 mb-2">Nenhum destinat√°rio cadastrado</h4>
                            <p class="text-gray-400">Clique em "Adicionar Destinat√°rio" para come√ßar</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Recipient Form -->
            <div id="addRecipientForm" class="hidden fade-in">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold text-gray-900">‚ûï Adicionar Novo Destinat√°rio</h3>
                        <button onclick="hideAddForm()" class="text-gray-400 hover:text-gray-600">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>

                    <!-- Explanatory Message -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-8">
                        <div class="flex items-start space-x-3">
                            <i data-lucide="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                            <div>
                                <h4 class="font-medium text-blue-900 mb-1">Por que precisamos dessas informa√ß√µes?</h4>
                                <p class="text-blue-700 text-sm">
                                    Preencha os dados abaixo para garantir que sua mensagem chegue com seguran√ßa e rapidez no momento certo. 
                                    Quanto mais informa√ß√µes voc√™ fornecer, mais f√°cil ser√° localizar e entregar sua mensagem para a pessoa escolhida.
                                </p>
                            </div>
                        </div>
                    </div>

                    <form id="recipientForm" onsubmit="handleSubmit(event)">
                        
                        <!-- Basic Information -->
                        <div class="form-section bg-gray-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center space-x-2">
                                <i data-lucide="user" class="w-5 h-5 text-blue-600"></i>
                                <span>Informa√ß√µes B√°sicas</span>
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Nome Completo <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="fullName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: Maria Silva Santos">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        E-mail <span class="text-red-500">*</span>
                                    </label>
                                    <input type="email" id="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: maria@email.com">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Relacionamento <span class="text-red-500">*</span>
                                    </label>
                                    <select id="relationship" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione...</option>
                                        <option value="filho">Filho(a)</option>
                                        <option value="esposo">Esposo(a)</option>
                                        <option value="pai">Pai/M√£e</option>
                                        <option value="irmao">Irm√£o(√£)</option>
                                        <option value="neto">Neto(a)</option>
                                        <option value="amigo">Amigo(a)</option>
                                        <option value="primo">Primo(a)</option>
                                        <option value="sobrinho">Sobrinho(a)</option>
                                        <option value="outro">Outro</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Data de Nascimento
                                    </label>
                                    <input type="date" id="birthDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="form-section bg-gray-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center space-x-2">
                                <i data-lucide="phone" class="w-5 h-5 text-green-600"></i>
                                <span>Informa√ß√µes de Contato</span>
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Telefone
                                    </label>
                                    <input type="tel" id="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: (11) 99999-9999">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Estado
                                    </label>
                                    <select id="state" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o estado...</option>
                                        <option value="AC">Acre</option>
                                        <option value="AL">Alagoas</option>
                                        <option value="AP">Amap√°</option>
                                        <option value="AM">Amazonas</option>
                                        <option value="BA">Bahia</option>
                                        <option value="CE">Cear√°</option>
                                        <option value="DF">Distrito Federal</option>
                                        <option value="ES">Esp√≠rito Santo</option>
                                        <option value="GO">Goi√°s</option>
                                        <option value="MA">Maranh√£o</option>
                                        <option value="MT">Mato Grosso</option>
                                        <option value="MS">Mato Grosso do Sul</option>
                                        <option value="MG">Minas Gerais</option>
                                        <option value="PA">Par√°</option>
                                        <option value="PB">Para√≠ba</option>
                                        <option value="PR">Paran√°</option>
                                        <option value="PE">Pernambuco</option>
                                        <option value="PI">Piau√≠</option>
                                        <option value="RJ">Rio de Janeiro</option>
                                        <option value="RN">Rio Grande do Norte</option>
                                        <option value="RS">Rio Grande do Sul</option>
                                        <option value="RO">Rond√¥nia</option>
                                        <option value="RR">Roraima</option>
                                        <option value="SC">Santa Catarina</option>
                                        <option value="SP">S√£o Paulo</option>
                                        <option value="SE">Sergipe</option>
                                        <option value="TO">Tocantins</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Cidade
                                    </label>
                                    <input type="text" id="city" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: S√£o Paulo">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        CEP
                                    </label>
                                    <input type="text" id="zipCode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: 01234-567">
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Endere√ßo Completo
                                </label>
                                <input type="text" id="address" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: Rua das Flores, 123, Apto 45, Jardim Primavera">
                            </div>
                        </div>

                        <!-- Social Media -->
                        <div class="form-section bg-gray-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center space-x-2">
                                <i data-lucide="share-2" class="w-5 h-5 text-purple-600"></i>
                                <span>Redes Sociais</span>
                            </h4>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Facebook
                                    </label>
                                    <input type="url" id="facebook" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: https://facebook.com/maria.silva">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Instagram
                                    </label>
                                    <input type="url" id="instagram" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: https://instagram.com/maria.silva">
                                </div>
                            </div>
                        </div>

                        <!-- References -->
                        <div class="form-section bg-gray-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center space-x-2">
                                <i data-lucide="users" class="w-5 h-5 text-orange-600"></i>
                                <span>Refer√™ncias Pessoais</span>
                            </h4>
                            
                            <div class="space-y-6">
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            Nome da Refer√™ncia 1
                                        </label>
                                        <input type="text" id="reference1Name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: Jo√£o Santos (amigo pr√≥ximo)">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            Telefone da Refer√™ncia 1
                                        </label>
                                        <input type="tel" id="reference1Phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: (11) 88888-8888">
                                    </div>
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            Nome da Refer√™ncia 2
                                        </label>
                                        <input type="text" id="reference2Name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: Ana Costa (colega de trabalho)">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            Telefone da Refer√™ncia 2
                                        </label>
                                        <input type="tel" id="reference2Phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: (11) 77777-7777">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Notes -->
                        <div class="form-section bg-gray-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center space-x-2">
                                <i data-lucide="file-text" class="w-5 h-5 text-indigo-600"></i>
                                <span>Observa√ß√µes Importantes</span>
                            </h4>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Informa√ß√µes Adicionais (opcional)
                                </label>
                                <textarea id="notes" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: Trabalha na empresa XYZ, frequenta a academia do bairro, tem um cachorro chamado Rex, costuma viajar nas f√©rias..."></textarea>
                                <p class="text-xs text-gray-500 mt-1">
                                    Inclua detalhes que possam ajudar a localizar o destinat√°rio no futuro (trabalho, hobbies, locais frequentados, etc.)
                                </p>
                            </div>
                        </div>

                        <!-- Security Message -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                            <div class="flex items-start space-x-3">
                                <i data-lucide="shield-check" class="w-5 h-5 text-green-600 mt-0.5"></i>
                                <div>
                                    <h4 class="font-medium text-green-900 mb-1">üîí Seguran√ßa e Privacidade</h4>
                                    <p class="text-green-700 text-sm">
                                        Esses dados s√£o usados apenas para confirmar a identidade do destinat√°rio e garantir que sua mensagem seja entregue, 
                                        mesmo que ele mude de telefone ou e-mail no futuro. Nosso compromisso √© que sua mensagem chegue onde precisa, no momento certo.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="flex items-center justify-between pt-6 border-t">
                            <button type="button" onclick="hideAddForm()" class="flex items-center space-x-2 px-6 py-3 text-gray-600 hover:text-gray-800">
                                <i data-lucide="x" class="w-5 h-5"></i>
                                <span>Cancelar</span>
                            </button>
                            
                            <button type="submit" class="gradient-bg text-white px-8 py-3 rounded-lg hover:opacity-90 transition-opacity flex items-center space-x-2">
                                <i data-lucide="user-plus" class="w-5 h-5"></i>
                                <span>Adicionar Destinat√°rio</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Upgrade Modal -->
    <div id="upgradeModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-900">üöÄ Upgrade de Plano</h3>
                <button onclick="closeUpgradeModal()" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- Premium Plan -->
                <div class="plan-card plan-premium rounded-xl p-6 cursor-pointer" onclick="selectPlan('premium')">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                <i data-lucide="star" class="w-5 h-5 text-green-600"></i>
                            </div>
                            <div>
                                <h4 class="text-xl font-bold text-gray-900">Plano Premium</h4>
                                <p class="text-gray-600">Ideal para fam√≠lias</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold text-gray-900">R$ 29,90</p>
                            <p class="text-sm text-gray-500">/m√™s</p>
                        </div>
                    </div>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li class="flex items-center space-x-2">
                            <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                            <span>At√© 10 destinat√°rios</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                            <span>Cofres ilimitados</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                            <span>Suporte priorit√°rio</span>
                        </li>
                    </ul>
                </div>

                <!-- VIP Plan -->
                <div class="plan-card plan-vip rounded-xl p-6 cursor-pointer" onclick="selectPlan('vip')">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                                <i data-lucide="crown" class="w-5 h-5 text-purple-600"></i>
                            </div>
                            <div>
                                <h4 class="text-xl font-bold text-gray-900">Plano VIP</h4>
                                <p class="text-gray-600">Para grandes fam√≠lias</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold text-gray-900">R$ 49,90</p>
                            <p class="text-sm text-gray-500">/m√™s</p>
                        </div>
                    </div>
                    <ul class="space-y-2 text-sm text-gray-700">
                        <li class="flex items-center space-x-2">
                            <i data-lucide="check" class="w-4 h-4 text-purple-600"></i>
                            <span>Destinat√°rios ilimitados</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i data-lucide="check" class="w-4 h-4 text-purple-600"></i>
                            <span>Cofres ilimitados</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i data-lucide="check" class="w-4 h-4 text-purple-600"></i>
                            <span>Suporte VIP 24/7</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i data-lucide="check" class="w-4 h-4 text-purple-600"></i>
                            <span>Recursos exclusivos</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        // Mock data for current user plan
        let currentPlan = {
            type: 'free', // free, premium, vip
            maxRecipients: 2,
            currentRecipients: 0
        };

        let recipients = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updatePlanDisplay();
            loadRecipients();
        });

        function updatePlanDisplay() {
            const planCard = document.getElementById('planCard');
            const planName = document.getElementById('planName');
            const planDescription = document.getElementById('planDescription');
            const currentCount = document.getElementById('currentCount');
            const maxCount = document.getElementById('maxCount');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const addButton = document.getElementById('addButton');

            // Update plan info
            switch(currentPlan.type) {
                case 'free':
                    planCard.className = 'plan-card rounded-2xl p-6 plan-free';
                    planName.textContent = 'Plano Gratuito';
                    planDescription.textContent = 'Voc√™ pode cadastrar at√© 2 destinat√°rios';
                    break;
                case 'premium':
                    planCard.className = 'plan-card rounded-2xl p-6 plan-premium';
                    planName.textContent = 'Plano Premium';
                    planDescription.textContent = 'Voc√™ pode cadastrar at√© 10 destinat√°rios';
                    break;
                case 'vip':
                    planCard.className = 'plan-card rounded-2xl p-6 plan-vip';
                    planName.textContent = 'Plano VIP';
                    planDescription.textContent = 'Destinat√°rios ilimitados';
                    break;
            }

            // Update counts
            currentCount.textContent = currentPlan.currentRecipients;
            maxCount.textContent = currentPlan.type === 'vip' ? '‚àû' : currentPlan.maxRecipients;

            // Update progress
            const progress = currentPlan.type === 'vip' ? 0 : (currentPlan.currentRecipients / currentPlan.maxRecipients) * 100;
            progressBar.style.width = progress + '%';
            progressText.textContent = Math.round(progress) + '%';

            // Update add button
            if (currentPlan.type !== 'vip' && currentPlan.currentRecipients >= currentPlan.maxRecipients) {
                addButton.disabled = true;
                addButton.innerHTML = '<i data-lucide="lock" class="w-5 h-5"></i><span>Limite Atingido</span>';
                addButton.className = 'bg-gray-400 text-white px-6 py-3 rounded-lg cursor-not-allowed flex items-center space-x-2';
            } else {
                addButton.disabled = false;
                addButton.innerHTML = '<i data-lucide="plus" class="w-5 h-5"></i><span>Adicionar Destinat√°rio</span>';
                addButton.className = 'gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity flex items-center space-x-2';
            }

            lucide.createIcons();
        }

        function loadRecipients() {
            const list = document.getElementById('recipientsList');
            
            if (recipients.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-12">
                        <i data-lucide="users" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                        <h4 class="text-xl font-medium text-gray-500 mb-2">Nenhum destinat√°rio cadastrado</h4>
                        <p class="text-gray-400">Clique em "Adicionar Destinat√°rio" para come√ßar</p>
                    </div>
                `;
            } else {
                list.innerHTML = recipients.map((recipient, index) => `
                    <div class="recipient-card bg-white rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                                    ${recipient.fullName.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-900">${recipient.fullName}</h4>
                                    <p class="text-sm text-gray-500">${recipient.relationship} ‚Ä¢ ${recipient.email}</p>
                                    <p class="text-xs text-gray-400">${recipient.city ? recipient.city + ', ' + recipient.state : 'Localiza√ß√£o n√£o informada'}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="editRecipient(${index})" class="text-blue-600 hover:text-blue-800">
                                    <i data-lucide="edit" class="w-5 h-5"></i>
                                </button>
                                <button onclick="deleteRecipient(${index})" class="text-red-600 hover:text-red-800">
                                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            lucide.createIcons();
        }

        function showAddForm() {
            if (currentPlan.type !== 'vip' && currentPlan.currentRecipients >= currentPlan.maxRecipients) {
                upgradePlan();
                return;
            }
            
            document.getElementById('addRecipientForm').classList.remove('hidden');
            document.getElementById('recipientForm').reset();
        }

        function hideAddForm() {
            document.getElementById('addRecipientForm').classList.add('hidden');
        }

        function handleSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const recipient = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                relationship: document.getElementById('relationship').value,
                birthDate: document.getElementById('birthDate').value,
                phone: document.getElementById('phone').value,
                state: document.getElementById('state').value,
                city: document.getElementById('city').value,
                zipCode: document.getElementById('zipCode').value,
                address: document.getElementById('address').value,
                facebook: document.getElementById('facebook').value,
                instagram: document.getElementById('instagram').value,
                reference1Name: document.getElementById('reference1Name').value,
                reference1Phone: document.getElementById('reference1Phone').value,
                reference2Name: document.getElementById('reference2Name').value,
                reference2Phone: document.getElementById('reference2Phone').value,
                notes: document.getElementById('notes').value,
                createdAt: new Date().toISOString()
            };

            recipients.push(recipient);
            currentPlan.currentRecipients++;
            
            updatePlanDisplay();
            loadRecipients();
            hideAddForm();
            
            alert('Destinat√°rio adicionado com sucesso!');
        }

        function editRecipient(index) {
            alert('Funcionalidade de edi√ß√£o ser√° implementada em breve!');
        }

        function deleteRecipient(index) {
            if (confirm('Tem certeza que deseja excluir este destinat√°rio?')) {
                recipients.splice(index, 1);
                currentPlan.currentRecipients--;
                updatePlanDisplay();
                loadRecipients();
            }
        }

        function upgradePlan() {
            document.getElementById('upgradeModal').classList.remove('hidden');
            document.getElementById('upgradeModal').classList.add('flex');
        }

        function closeUpgradeModal() {
            document.getElementById('upgradeModal').classList.add('hidden');
            document.getElementById('upgradeModal').classList.remove('flex');
        }

        function selectPlan(planType) {
            // Simulate plan upgrade
            alert(`Redirecionando para pagamento do Plano ${planType === 'premium' ? 'Premium' : 'VIP'}...`);
            
            // Mock upgrade for demo
            if (planType === 'premium') {
                currentPlan.type = 'premium';
                currentPlan.maxRecipients = 10;
            } else {
                currentPlan.type = 'vip';
                currentPlan.maxRecipients = Infinity;
            }
            
            updatePlanDisplay();
            closeUpgradeModal();
        }

        function goBack() {
            window.history.back();
        }

        // Phone mask
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                if (value.length < 14) {
                    value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                }
                e.target.value = value;
            }
        });

        // CEP mask
        document.getElementById('zipCode').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/(\d{5})(\d{3})/, '$1-$2');
                e.target.value = value;
            }
        });
    </script>
</body>
</html>

